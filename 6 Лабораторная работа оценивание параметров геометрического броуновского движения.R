#6. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–≥–æ –±—Ä–æ—É–Ω–æ–≤—Å–∫–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
#1. –ó–∞–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (10) –¥–ª—è ùëÜ0 = 100, ùëé = 0.5, ùúé = 0.8, ‚àö‚àÜ = 0.01,ùëò = 0, 1, . . . , 10^3
set.seed(123) # –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
N = 1000 # —á–∏—Å–ª–æ —à–∞–≥–æ–≤
delta = 0.01 # —à–∞–≥ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
S0 = 100 # –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ S
a = 0.5 # –∏—Å—Ç–∏–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ a
sigma = 0.8 # –∏—Å—Ç–∏–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ sigma

t = seq(0, N*delta, delta)#–≤–µ–∫—Ç–æ—Ä –º–æ–º–µ–Ω—Ç–æ–≤ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π
length(t)
S = numeric(N+1)# –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ S
S[1] = S0
B = numeric(length(t))
B[1] = 0

for(k in 2:(N+1)) {B[k] = B[k-1] + rnorm(1,0,0.01) 
                   S[k] = S[1]*exp((a-sigma^2/2)*(k)*delta+sigma*B[k])
                   }

plot(t, S, type='l', col='gray', xlab='t', ylab='S(t)', main=' S(t)')
for (i in 2:(N+1)) {lines(t, S)}
# 2. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ—Ü–µ–Ω–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±—Ä–æ—É–Ω–æ–≤—Å–∫–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è (ùëé,ùúé^2) –ø–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º –ø—Ä–æ—Ü–µ—Å—Å–∞ {ùëÜùëò‚àÜ}ùëò‚â•1.
# —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏—è
for (k in 2:(N+1)) {S[k] = S[k-1] * exp((a - sigma^2/2) * delta + sigma * sqrt(delta) * rnorm(1))}
loglik = function(theta, data) {a = theta[1]
                                 sigma2 = theta[2]
                                 S = data
                                 n = length(S) - 1
                                 res = rep(0, n)
                                 for (i in 2:(n+1)) { res[i-1] = log(S[i]) - log(S[i-1]) - (a - sigma2/2) * delta}
                                 loglik = -n/2*log(2*pi) - n/2*log(sigma2*delta) - 1/(2*sigma2*delta)*sum(res^2)
                                 return(-loglik)}

# –æ—Ü–µ–Ω–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–µ—Ç–æ–¥–æ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏—è
start = c(0.01, 0.01)
result = optim(start, loglik, data=S, method="L-BFGS-B", lower=c(0, 0), upper=c(Inf, Inf))

# –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
cat("–û—Ü–µ–Ω–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ a:", result$par[1], "\n")
cat("–û—Ü–µ–Ω–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ sigma^2:", result$par[2], "\n")

X = numeric(length(t))
for(i in 1:N){X[i] = log(S[i+1]) - log(S[i])}
M = mean(X)
D = var(X)*(N-1)/N
cat("–û—Ü–µ–Ω–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ a:", M/delta + (D/delta)/2, "\n")
cat("–û—Ü–µ–Ω–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ sigma^2:", D/delta, "\n")
